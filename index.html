<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Safe The Uyghurs</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #111;
            font-family: 'Press Start 2P', cursive;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        canvas {
            display: block;
            margin: 0 auto;
            background-color: #dcb159;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* UI LAYOUT */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #top-ui {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            font-size: 14px;
        }

        /* SCREENS */
        #start-screen, #game-over-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 24, 33, 0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
            pointer-events: auto;
            text-align: center;
        }

        h1 { 
            font-size: 24px; color: #ffcc00; margin-bottom: 5px; 
            text-shadow: 4px 4px 0 #8b0000;
        }
        
        .mode-container {
            display: flex; gap: 10px; margin-top: 20px; width: 90%; justify-content: center;
        }

        .mode-card {
            border: 2px solid #555; background: #222; padding: 10px; width: 45%;
            cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center;
        }

        .mode-card:active { border-color: #ffcc00; background: #333; transform: scale(1.05); }

        .btn {
            background: #d32f2f; border: 4px solid #fff; padding: 15px 30px;
            color: white; font-family: 'Press Start 2P'; font-size: 16px; cursor: pointer; margin-top: 20px;
        }

        /* CONTROLS OVERLAY */
        .controls-hint {
            display: flex; width: 100%; height: 180px; pointer-events: none;
            position: absolute; bottom: 0;
        }
        .left-control { width: 50%; background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, transparent 60%); }
        
        /* Right Control Area - Dynamic based on mode */
        .right-control { 
            width: 50%; display: flex; align-items: center; justify-content: center; pointer-events: auto; 
            position: relative;
        }

        /* Buttons */
        .game-btn {
            border-radius: 50%; border: 4px solid rgba(255,255,255,0.8); 
            background: rgba(0,0,0,0.3); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; position: absolute;
            touch-action: manipulation;
        }
        .game-btn:active { background: rgba(255,255,255,0.3); transform: scale(0.95); }

        /* Whistleblower Layout */
        #btn-flash { width: 90px; height: 90px; right: 30px; bottom: 45px; }

        /* Perpetrator Layout */
        #btn-kick { width: 70px; height: 70px; right: 20px; bottom: 90px; background: #500; }
        #btn-grab { width: 70px; height: 70px; right: 90px; bottom: 20px; background: #005; }

        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="top-ui">
            <span id="score-label">SCORE: <span id="score-val">0</span></span>
        </div>
        
        <div class="controls-hint">
            <div class="left-control" id="joystick-zone"></div>
            
            <div class="right-control">
                <div id="btn-flash" class="game-btn hidden" ontouchstart="actionFlash(event)">üì∏</div>
                
                <div id="btn-kick" class="game-btn hidden" ontouchstart="actionKick(event)">üèè</div>
                <div id="btn-grab" class="game-btn hidden" ontouchstart="actionGrab(event)">‚úã</div>
            </div>
        </div>
    </div>

    <div id="start-screen">
        <h1>SAFE THE<br>UYGHURS</h1>
        <p style="font-size: 10px; color: #888;">CHOOSE YOUR SIDE</p>
        
        <div class="mode-container">
            <div class="mode-card" onclick="setMode('whistleblower')">
                <div style="font-size:10px; color:#aaa">MODE 1</div>
                <div style="margin:5px 0">WHISTLE<br>BLOWER</div>
                <canvas id="p1-canvas" width="60" height="60" style="background:#dcb159; border:2px solid #000"></canvas>
            </div>
            <div class="mode-card" onclick="setMode('perpetrator')">
                <div style="font-size:10px; color:#aaa">MODE 2</div>
                <div style="margin:5px 0">PERPE<br>TRATOR</div>
                <canvas id="p2-canvas" width="60" height="60" style="background:#dcb159; border:2px solid #000"></canvas>
            </div>
        </div>
    </div>

    <div id="game-over-screen" style="display: none;">
        <h1 id="go-title" style="color: #ff5555">GAME OVER</h1>
        <p id="go-reason">...</p>
        <p>Score: <span id="final-score">0</span></p>
        <button class="btn" onclick="showStartScreen()">MENU</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Fit to screen
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- CONFIGURATION ---
    const C = {
        sand: '#dcb159', sandDetail: '#cba048',
        wall: '#3b434e', door: '#1a1a1a', wire: '#111',
        skin: '#ffdbac',
        wbVest: '#55aaff',
        swatVest: '#1a1a1a', swatVisor: '#cc0000',
        flash: 'rgba(255, 255, 255, 0.9)'
    };

    // --- STATE ---
    let GAME_MODE = 'whistleblower';
    let gameActive = false;
    let frame = 0;
    let score = 0;
    let cooldown = 0; // Global action cooldown
    
    let hero = { 
        x: 0, y: 0, speed: 4, hp: 100, 
        angle: 0, // Aim angle in radians
        state: 'idle', 
        holding: null,
        flashTimer: 0 // For visual duration
    };
    
    let entities = [];
    let items = []; // Coins/Batteries
    let particles = [];

    // Controls
    let joystick = { on: false, id: null, sx: 0, sy: 0, cx: 0, cy: 0 };

    // --- UI HELPERS ---
    function updateControlsUI() {
        const btnFlash = document.getElementById('btn-flash');
        const btnKick = document.getElementById('btn-kick');
        const btnGrab = document.getElementById('btn-grab');

        if(GAME_MODE === 'whistleblower') {
            btnFlash.classList.remove('hidden');
            btnKick.classList.add('hidden');
            btnGrab.classList.add('hidden');
        } else {
            btnFlash.classList.add('hidden');
            btnKick.classList.remove('hidden');
            btnGrab.classList.remove('hidden');
        }
    }

    // --- DRAW MENU PORTRAITS ---
    function drawMenuPortraits() {
        const p1 = document.getElementById('p1-canvas').getContext('2d');
        const p2 = document.getElementById('p2-canvas').getContext('2d');
        p1.translate(30, 40); p1.scale(1.5,1.5);
        drawCharacter(p1, {type:'hero_wb', state:'idle', angle:Math.PI/2, hp:100});
        p2.translate(30, 40); p2.scale(1.5,1.5);
        drawCharacter(p2, {type:'hero_swat', state:'idle', angle:Math.PI/2, hp:100});
    }
    setTimeout(drawMenuPortraits, 100);

    // --- INPUT HANDLING ---
    const joyZone = document.getElementById('joystick-zone');
    
    joyZone.addEventListener('touchstart', e => {
        e.preventDefault();
        let t = e.changedTouches[0];
        joystick.on = true; joystick.id = t.identifier;
        joystick.sx = t.clientX; joystick.sy = t.clientY;
        joystick.cx = t.clientX; joystick.cy = t.clientY;
    }, {passive:false});

    joyZone.addEventListener('touchmove', e => {
        e.preventDefault();
        for(let t of e.changedTouches) {
            if(joystick.on && t.identifier === joystick.id) {
                joystick.cx = t.clientX; joystick.cy = t.clientY;
            }
        }
    }, {passive:false});

    joyZone.addEventListener('touchend', e => {
        e.preventDefault();
        for(let t of e.changedTouches) {
            if(joystick.on && t.identifier === joystick.id) joystick.on = false;
        }
    }, {passive:false});

    // Button Actions
    function actionFlash(e) { e.preventDefault(); e.stopPropagation(); doAction('flash'); }
    function actionKick(e) { e.preventDefault(); e.stopPropagation(); doAction('kick'); }
    function actionGrab(e) { e.preventDefault(); e.stopPropagation(); doAction('grab'); }

    // PC Debug
    window.addEventListener('keydown', e => {
        if(e.code==='Space') {
            if(GAME_MODE === 'whistleblower') doAction('flash');
            else doAction('kick');
        }
        if(e.code==='ShiftLeft' && GAME_MODE === 'perpetrator') doAction('grab');
    });

    // --- GAME FLOW ---
    function showStartScreen() {
        document.getElementById('start-screen').style.display = 'flex';
        document.getElementById('game-over-screen').style.display = 'none';
        gameActive = false;
    }

    function setMode(mode) {
        GAME_MODE = mode;
        updateControlsUI();
        startGame();
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-over-screen').style.display = 'none';
        
        hero.x = canvas.width/2;
        hero.y = canvas.height - 150;
        hero.hp = 100;
        hero.angle = -Math.PI/2; // Facing Up
        hero.holding = null;
        hero.flashTimer = 0;
        
        score = 0;
        entities = [];
        items = [];
        particles = [];
        gameActive = true;
        loop();
    }

    function loop() {
        if(!gameActive) return;
        update();
        draw();
        frame++;
        requestAnimationFrame(loop);
    }

    // --- UPDATE LOGIC ---
    function update() {
        if(cooldown > 0) cooldown--;
        if(hero.flashTimer > 0) hero.flashTimer--;

        // 1. Hero Movement & Aiming
        let dx = 0, dy = 0;
        if(joystick.on) {
            dx = joystick.cx - joystick.sx;
            dy = joystick.cy - joystick.sy;
            let dist = Math.sqrt(dx*dx + dy*dy);
            
            if(dist > 5) {
                // Update Aim Angle
                hero.angle = Math.atan2(dy, dx);
                
                let spd = hero.holding ? hero.speed * 0.6 : hero.speed;
                // Normalize movement vector
                hero.x += Math.cos(hero.angle) * spd;
                hero.y += Math.sin(hero.angle) * spd;
            }
        }

        // Boundaries
        if(hero.x < 15) hero.x = 15;
        if(hero.x > canvas.width - 15) hero.x = canvas.width - 15;
        
        let topLimit = 120;
        // Perp holding civ can enter door zone
        if (GAME_MODE === 'perpetrator' && hero.holding && Math.abs(hero.x - canvas.width/2) < 40) {
            topLimit = 80;
        }
        
        if(hero.y < topLimit) {
            if(GAME_MODE === 'perpetrator' && hero.holding) {
                score += 100;
                hero.holding.dead = true;
                hero.holding = null;
                hero.y = 130; 
                spawnFloatingText(hero.x, hero.y, "+100", "#fff");
            } else {
                hero.y = topLimit;
            }
        }
        if(hero.y > canvas.height - 15) hero.y = canvas.height - 15;

        // State update
        hero.state = (dx !== 0 || dy !== 0) ? 'run' : 'idle';

        // 2. Spawn Logic
        if(frame % 100 === 0) spawnEntity('civ');
        
        let threatRate = Math.max(60, 200 - score/2);
        if(frame % Math.floor(threatRate) === 0) {
            if(GAME_MODE === 'whistleblower') spawnEntity('swat_enemy');
            else spawnEntity('wb_enemy'); // Solo perp vs WBs
        }

        // Spawn Items (Rare)
        if(frame % 300 === 0) spawnItem();

        // 3. Entity Loop
        entities.forEach(e => {
            if(e.dead) return;

            // --- CIVILIAN ---
            if(e.type === 'civ') {
                if(e.state === 'run') {
                    e.y += e.speed;
                    e.x += Math.sin(frame*0.1 + e.id) * 0.5; 
                    if(e.y > canvas.height + 20) {
                        e.dead = true;
                        if(GAME_MODE === 'whistleblower') score += 100;
                    }
                }
            }

            // --- ENEMIES (AI) ---
            if(e.ai) {
                // ENEMY SWAT (WB Mode)
                if(e.type === 'swat') {
                    let target = hero; // Target player
                    let d = dist(e, target);
                    
                    if(d < 1000) { // Chase
                        let ang = Math.atan2(target.y - e.y, target.x - e.x);
                        e.angle = ang;
                        if(d > 30) {
                            e.x += Math.cos(ang) * e.speed;
                            e.y += Math.sin(ang) * e.speed;
                            e.state = 'run';
                        } else {
                            // Attack Player
                            if(frame % 30 === 0) damageHero(15);
                            e.state = 'idle';
                        }
                    }
                }
                
                // ENEMY WB (Perp Mode)
                if(e.type === 'wb') {
                    let d = dist(e, hero);
                    // Keep distance but aim at player
                    let ang = Math.atan2(hero.y - e.y, hero.x - e.x);
                    e.angle = ang;

                    if(d > 200) {
                        e.x += Math.cos(ang) * e.speed;
                        e.y += Math.sin(ang) * e.speed;
                        e.state = 'run';
                    } else if (d < 100) {
                        // Back away
                        e.x -= Math.cos(ang) * e.speed;
                        e.y -= Math.sin(ang) * e.speed;
                        e.state = 'run';
                    } else {
                        e.state = 'idle';
                        // FLASH ATTACK
                        if(frame % 60 === 0 && Math.random() < 0.5) {
                            e.flashTimer = 10;
                            if(Math.abs(normalizeAngle(ang - Math.atan2(hero.y - e.y, hero.x - e.x))) < 0.5) {
                                damageHero(10); // Flash hurts perp
                            }
                        }
                    }
                    if(e.flashTimer > 0) e.flashTimer--;
                }
            }
        });

        // 4. Items Collision
        items.forEach(item => {
            if(item.dead) return;
            if(dist(hero, item) < 30) {
                // Correct item for mode?
                if((GAME_MODE === 'whistleblower' && item.type === 'battery') ||
                   (GAME_MODE === 'perpetrator' && item.type === 'coin')) {
                    item.dead = true;
                    hero.hp = Math.min(100, hero.hp + 20);
                    spawnFloatingText(hero.x, hero.y, "+HP", "#0f0");
                }
            }
        });

        // Hero Holding logic
        if(hero.holding) {
            hero.holding.x = hero.x + Math.cos(hero.angle + Math.PI)*15;
            hero.holding.y = hero.y + Math.sin(hero.angle + Math.PI)*15;
            hero.holding.angle = hero.angle; // Face same way
        }

        document.getElementById('score-val').innerText = score;

        // Cleanup
        entities = entities.filter(e => !e.dead);
        items = items.filter(i => !i.dead);
        particles.forEach(p => { p.x+=p.vx; p.y+=p.vy; p.life--; });
        particles = particles.filter(p => p.life > 0);
    }

    // --- ACTIONS ---
    function doAction(type) {
        if(!gameActive) return;

        if(type === 'flash' && cooldown <= 0) {
            cooldown = 30;
            hero.flashTimer = 10;
            
            // Check Hits Cone 360
            entities.forEach(e => {
                if(e.type === 'swat') {
                    let d = dist(hero, e);
                    let angToE = Math.atan2(e.y - hero.y, e.x - hero.x);
                    let diff = normalizeAngle(angToE - hero.angle);
                    
                    if(d < 180 && Math.abs(diff) < 0.7) { // ~45 degrees each side
                        e.dead = true;
                        spawnExplosion(e.x, e.y);
                        score += 50;
                    }
                }
            });
        }
        else if (type === 'kick' && cooldown <= 0) {
            cooldown = 20;
            hero.swing = 10; // Visual
            
            entities.forEach(e => {
                if(dist(hero, e) < 50 && !e.dead) {
                    // Kick WB
                    if(e.type === 'wb') {
                        e.dead = true;
                        spawnBlood(e.x, e.y);
                        score += 50;
                    }
                    // Kick Civ (Stun)
                    if(e.type === 'civ') {
                        e.state = 'stunned';
                        spawnBlood(e.x, e.y);
                    }
                }
            });
        }
        else if (type === 'grab') {
            if(hero.holding) {
                // Drop
                hero.holding.state = 'run';
                hero.holding = null;
            } else {
                // Try Grab
                let target = null;
                entities.forEach(e => {
                    if(e.type === 'civ' && dist(hero, e) < 40) {
                        target = e;
                    }
                });
                if(target) {
                    hero.holding = target;
                    target.state = 'captured';
                }
            }
        }
    }

    // --- HELPERS ---
    function spawnEntity(type) {
        let x = canvas.width/2 + (Math.random()*200-100);
        let e = {
            id: Math.random(), x: x, y: 110, dead: false, anim: Math.random()*10,
            angle: Math.PI/2 // Facing down initially
        };

        if(type === 'civ') {
            e.type = 'civ'; e.color = `hsl(${Math.random()*360}, 70%, 50%)`;
            e.speed = 1.5 + Math.random(); e.state = 'run';
        } 
        else if (type === 'swat_enemy') {
            e.type = 'swat'; e.ai = true; e.speed = 2.8; e.state = 'hunt';
        } 
        else if (type === 'wb_enemy') {
            e.type = 'wb'; e.ai = true; e.speed = 2.0; e.state = 'hunt'; e.flashTimer = 0;
        }
        entities.push(e);
    }

    function spawnItem() {
        let type = GAME_MODE === 'whistleblower' ? 'battery' : 'coin';
        items.push({
            type: type,
            x: 20 + Math.random()*(canvas.width-40),
            y: 150 + Math.random()*(canvas.height-180),
            dead: false
        });
    }

    function spawnFloatingText(x, y, text, color) {
        // Simple visual hack using particles
        // In a complex engine, use a UI layer. Here we just console log or logic.
    }

    function damageHero(amount) {
        hero.hp -= amount;
        spawnBlood(hero.x, hero.y);
        if(hero.hp <= 0) {
            gameActive = false;
            document.getElementById('go-title').innerText = "FAILED";
            document.getElementById('go-reason').innerText = GAME_MODE === 'whistleblower' ? "CAMERA DESTROYED" : "OVERWHELMED";
            document.getElementById('final-score').innerText = score;
            document.getElementById('game-over-screen').style.display = 'flex';
        }
    }

    function dist(a, b) { return Math.hypot(a.x - b.x, a.y - b.y); }
    function normalizeAngle(a) { while(a > Math.PI) a -= Math.PI*2; while(a < -Math.PI) a += Math.PI*2; return a; }

    function spawnExplosion(x,y) { for(let i=0;i<15;i++) particles.push({x:x, y:y, vx:(Math.random()-.5)*10, vy:(Math.random()-.5)*10, color:'#000', life:20, size:4}); }
    function spawnBlood(x,y) { for(let i=0;i<8;i++) particles.push({x:x, y:y, vx:(Math.random()-.5)*5, vy:(Math.random()-.5)*5, color:'#f00', life:30, size:3}); }

    // --- DRAWING ---
    function draw() {
        ctx.fillStyle = C.sand; ctx.fillRect(0,0,canvas.width, canvas.height);
        
        // Wall
        ctx.fillStyle = C.wall; ctx.fillRect(0,0,canvas.width, 120);
        ctx.fillStyle = C.door; ctx.fillRect(canvas.width/2-30, 70, 60, 50);
        ctx.strokeStyle = C.wire; ctx.lineWidth = 2; ctx.beginPath();
        for(let i=-20; i<canvas.width; i+=15) ctx.arc(i, 120, 10, 0, Math.PI*2);
        ctx.stroke();

        // Items
        items.forEach(i => drawItem(i));

        // Shadows
        ctx.fillStyle = 'rgba(0,0,0,0.3)';
        entities.forEach(e => { if(!e.dead) drawShadow(e.x, e.y); });
        drawShadow(hero.x, hero.y);

        // Entities
        entities.forEach(e => {
            if(e.dead) return;
            drawCharacter(ctx, {
                type: e.type === 'civ' ? 'civ' : (e.type === 'swat' ? 'hero_swat' : 'hero_wb'),
                state: e.state, angle: e.angle || Math.PI/2, anim: frame + e.anim, color: e.color
            }, e.x, e.y);

            // Enemy Flash
            if(e.type === 'wb' && e.flashTimer > 0) drawFlash(e);
        });

        // Hero
        let hType = GAME_MODE === 'whistleblower' ? 'hero_wb' : 'hero_swat';
        drawCharacter(ctx, {type: hType, state: hero.state, angle: hero.angle, anim: frame, hp: hero.hp}, hero.x, hero.y);
        
        // Hero Flash
        if(hero.flashTimer > 0) drawFlash(hero);

        // Particles
        particles.forEach(p => { ctx.fillStyle=p.color; ctx.fillRect(p.x, p.y, p.size, p.size); });
    }

    function drawShadow(x,y) { ctx.beginPath(); ctx.ellipse(x, y, 10, 4, 0, 0, Math.PI*2); ctx.fill(); }

    function drawFlash(char) {
        ctx.save();
        ctx.translate(char.x, char.y);
        ctx.rotate(char.angle);
        ctx.fillStyle = C.flash;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.lineTo(180, -60);
        ctx.lineTo(180, 60);
        ctx.fill();
        ctx.restore();
    }

    function drawItem(item) {
        ctx.save(); ctx.translate(item.x, item.y);
        if(item.type === 'battery') {
            ctx.fillStyle = '#444'; ctx.fillRect(-6,-10,12,20);
            ctx.fillStyle = '#0f0'; ctx.fillRect(-4,-5,8,12); // Charge
            ctx.fillStyle = '#aaa'; ctx.fillRect(-3,-13,6,3); // Tip
        } else {
            ctx.fillStyle = '#FFD700'; ctx.beginPath(); ctx.arc(0,0,8,0,Math.PI*2); ctx.fill();
            ctx.fillStyle = '#DAA520'; ctx.font="10px Arial"; ctx.fillText("$", -3, 3);
        }
        ctx.restore();
    }

    function drawCharacter(c, data, x=0, y=0) {
        c.save();
        c.translate(x, y);
        
        // Health Bar (for Hero)
        if(data.hp !== undefined && data.hp < 100) {
            c.fillStyle = 'red'; c.fillRect(-15, -45, 30, 4);
            c.fillStyle = '#0f0'; c.fillRect(-15, -45, 30*(data.hp/100), 4);
        }

        // Bobbing
        let s = (data.state === 'run') ? Math.sin(data.anim*0.3)*2 : 0;
        
        // Rotate body based on 360 aim
        // We only rotate the upper body or the whole sprite? 
        // Top-down simplified view:
        
        // Legs (Always orient downwards visually for style, or rotate?)
        // Let's rotate everything for 360 feel
        c.rotate(data.angle + Math.PI/2); // +PI/2 because art is drawn facing up/down

        // Legs
        let walk = (data.state === 'run') ? Math.sin(data.anim*0.3)*6 : 0;
        c.fillStyle = '#000';
        c.fillRect(-6, -5+walk, 4, 10);
        c.fillRect(2, -5-walk, 4, 10);

        // Body
        if(data.type === 'civ') {
            c.fillStyle = data.color; c.fillRect(-8, -12, 16, 12);
            c.fillStyle = C.skin; c.beginPath(); c.arc(0, -12, 5, 0, Math.PI*2); c.fill();
        }
        else if(data.type === 'hero_wb') {
            c.fillStyle = C.wbVest; c.fillRect(-8, -12, 16, 12); // Vest
            c.fillStyle = C.skin; c.beginPath(); c.arc(0, -12, 5, 0, Math.PI*2); c.fill(); // Head
            c.fillStyle = '#111'; c.beginPath(); c.arc(0, -12, 6, 0, Math.PI, true); c.fill(); // Hair
            // Camera
            c.fillStyle = '#222'; c.fillRect(2, -18, 6, 8);
        }
        else if(data.type === 'hero_swat') {
            c.fillStyle = C.swatVest; c.fillRect(-9, -12, 18, 14);
            c.fillStyle = '#000'; c.beginPath(); c.arc(0, -12, 6, 0, Math.PI*2); c.fill(); // Helmet
            c.fillStyle = C.swatVisor; c.fillRect(-4, -16, 8, 2);
            
            // Bat
            if(hero.swing && GAME_MODE === 'perpetrator' && data.hp !== undefined) {
                c.save(); c.rotate(Math.sin(hero.swing)*2);
                c.fillStyle = '#222'; c.fillRect(8, -20, 4, 25);
                c.restore();
            }
        }
        c.restore();
    }
</script>
</body>
</html>
